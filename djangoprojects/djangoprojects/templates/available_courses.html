{% extends 'base.html' %}

{% block title %}加選課程{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2>加選課程</h2>
  
  <!-- 搜尋課程表單 -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <form method="get" action="{% url 'available_courses' %}" class="row g-3">
        <div class="col-md-6">
          <input 
            type="text" 
            class="form-control" 
            name="search" 
            placeholder="搜尋課程代碼或課程名稱..."
            value="{{ search_query }}"
          >
        </div>
        <div class="col-md-2">
          <button type="submit" class="btn btn-primary w-100">搜尋</button>
        </div>
        {% if search_query %}
        <div class="col-md-2">
          <a href="{% url 'available_courses' %}" class="btn btn-secondary w-100">清除</a>
        </div>
        {% endif %}
      </form>
    </div>
  </div>

  {% if search_query %}
  <p class="mb-3 text-muted">搜尋結果：「<strong>{{ search_query }}</strong>」</p>
  {% endif %}
  
  {% if courses %}
  <table class="table table-striped table-hover">
    <thead class="table-dark">
      <tr>
        <th>課程代碼</th>
        <th>課程名稱</th>
        <th>任課老師</th>
        <th>加退選</th>
      </tr>
    </thead>
    <tbody>
      {% for course in courses %}
      <tr>
        <td><strong>{{ course.code }}</strong></td>
        <td>{{ course.name }}</td>
        <td>
          {% if course.teacher and course.teacher.user and course.teacher.user.profile and course.teacher.user.profile.is_teacher %}
            {{ course.teacher.user.username }}
          {% else %}
            <span class="text-muted">未分配</span>
          {% endif %}
        </td>
        <td>
          {% if user.is_authenticated %}
            <a href="{% url 'enroll_student_course' course.id %}" class="btn btn-sm btn-success">加選</a>
          {% else %}
            <a href="{% url 'login' %}?next={% url 'available_courses' %}" class="btn btn-sm btn-outline-primary">請先登入</a>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <div class="alert alert-info">沒有可加選的課程。</div>
  {% endif %}

  <div class="mt-3">
    <a href="{% url 'student_courses' %}" class="btn btn-primary">回到我的課程</a>
  </div>
</div>
{% endblock %}